'use strict';

const Ajv = require('ajv');
const ajv = new Ajv({ allErrors: true, removeAdditional: true });
const { map } = require('lodash');

const validator = (schema, data) => {
  const validate = ajv.compile(schema);
  const valid = validate(data);
  let errors = ajv.errorsText(validate.errors).split(', ');
  errors = map(errors, err => {
    if (err.indexOf('should match pattern') !== -1) {
      return err.split(' ').splice(-1).pop() + ' IncorrectFormat';
    }
    return err.split(' ').splice(-1).pop() + ' Required';
  });
  return {
    valid,
    errors
  };
};

module.exports = validator;